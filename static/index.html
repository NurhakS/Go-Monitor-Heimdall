<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heimdall</title>
    <!-- Add preload for Font Awesome to ensure it loads quickly -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" as="style">
    <!-- Load CSS files with proper attributes -->
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Add inline styles for critical elements to ensure they display correctly -->
    <style>
        /* Critical styles to ensure proper display */
        .status-up {
            color: #28a745 !important;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-down {
            color: #dc3545 !important;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-pending {
            color: #ffc107 !important;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-unauthorized {
            color: #ff8c00 !important;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .monitor-table tbody tr {
            transition: all 0.2s ease;
        }
        
        .monitor-table tbody tr:hover {
            background-color: #2a2a2a;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background: linear-gradient(135deg, #c5a572 0%, #b38b5d 50%, #c5a572 100%);
            color: white;
            box-shadow: 0 2px 4px rgba(197, 165, 114, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            background: linear-gradient(135deg, #ff8c00 0%, #ff6b00 50%, #ff8c00 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(197, 165, 114, 0.4);
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <header class="header">
        <h1 style="margin: 0; font-size: 2rem; font-weight: 700; background: var(--metallic-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; letter-spacing: 2px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);">HEIMDALL</h1>
        <div style="display: flex; align-items: center;">
            <select id="profileSelect" class="profile-select" onchange="handleProfileChange()" style="background: var(--secondary-bg); border: 1px solid var(--border-color); color: var(--text-primary); padding: 0.5rem; border-radius: 0.375rem; margin-right: 1rem;">
                <option value="">Loading profiles...</option>
            </select>
            <button class="btn btn-small" onclick="showAddProfileModal()" style="margin-left: 0.5rem; display: flex; align-items: center; gap: 0.5rem; background: linear-gradient(135deg, #c5a572 0%, #b38b5d 100%); color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; border: none; font-weight: 600; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px; font-size: 0.8rem; box-shadow: 0 2px 4px rgba(197, 165, 114, 0.3);">
                <i class="fas fa-plus"></i> Add Profile
            </button>
        </div>
    </header>

    <nav class="nav-bar" style="background: var(--secondary-bg); border-bottom: 1px solid var(--border-color); padding: 0.75rem 1rem; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
        <div class="container">
            <div style="display: flex; align-items: center;">
                <h1 style="font-size: 1.5rem; font-weight: bold; margin-right: 2rem; background: var(--metallic-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; letter-spacing: 2px;">HEIMDALL</h1>
                <div style="display: flex; gap: 1.5rem;">
                    <a href="/" style="color: var(--accent-color); text-decoration: none; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; position: relative; padding-bottom: 0.25rem;">
                        <i class="fas fa-chart-line" style="margin-right: 0.5rem;"></i>Monitors
                        <span style="position: absolute; bottom: 0; left: 0; width: 100%; height: 2px; background: var(--gold-gradient);"></span>
                    </a>
                    <a href="/notifications" style="color: var(--text-secondary); text-decoration: none; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; transition: color 0.2s;">
                        <i class="fas fa-bell" style="margin-right: 0.5rem;"></i>Notifications
                    </a>
                    <a href="/credentials" style="color: var(--text-secondary); text-decoration: none; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; transition: color 0.2s;">
                        <i class="fas fa-key" style="margin-right: 0.5rem;"></i>Credentials
                    </a>
                    <a href="/profiles" style="color: var(--text-secondary); text-decoration: none; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; transition: color 0.2s;">
                        <i class="fas fa-user-shield" style="margin-right: 0.5rem;"></i>Profiles
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <main class="container" style="padding-top: 2rem;">
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(42, 42, 42, 0.8) 0%, rgba(26, 26, 26, 0.9) 100%); padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); border: 1px solid var(--border-color); transition: all 0.3s ease;">
                <div style="color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem; margin-bottom: 0.5rem; display: flex; align-items: center;">
                    <i class="fas fa-chart-network" style="margin-right: 0.5rem; color: var(--accent-color);"></i>Total Monitors
                </div>
                <div id="totalMonitors" style="font-size: 2.5rem; font-weight: bold; margin-top: 0.5rem; color: var(--text-primary); display: flex; align-items: center;">
                    <i class="fas fa-chart-line" style="color: var(--accent-color); margin-right: 0.75rem; font-size: 2rem;"></i> 0
                </div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(42, 42, 42, 0.8) 0%, rgba(26, 26, 26, 0.9) 100%); padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); border: 1px solid var(--border-color); transition: all 0.3s ease;">
                <div style="color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem; margin-bottom: 0.5rem; display: flex; align-items: center;">
                    <i class="fas fa-arrow-up" style="margin-right: 0.5rem; color: var(--status-up);"></i>Monitors Up
                </div>
                <div id="upMonitors" style="font-size: 2.5rem; font-weight: bold; margin-top: 0.5rem; color: var(--status-up); display: flex; align-items: center;">
                    <i class="fas fa-check-circle" style="color: var(--status-up); margin-right: 0.75rem; font-size: 2rem;"></i> 0
                </div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, rgba(42, 42, 42, 0.8) 0%, rgba(26, 26, 26, 0.9) 100%); padding: 1.5rem; border-radius: 0.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); border: 1px solid var(--border-color); transition: all 0.3s ease;">
                <div style="color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem; margin-bottom: 0.5rem; display: flex; align-items: center;">
                    <i class="fas fa-arrow-down" style="margin-right: 0.5rem; color: var(--status-down);"></i>Monitors Down
                </div>
                <div id="downMonitors" style="font-size: 2.5rem; font-weight: bold; margin-top: 0.5rem; color: var(--status-down); display: flex; align-items: center;">
                    <i class="fas fa-times-circle" style="color: var(--status-down); margin-right: 0.75rem; font-size: 2rem;"></i> 0
                </div>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin: 2rem 0 1rem;">
            <h2 style="font-size: 1.5rem; font-weight: bold; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 2px; background: var(--metallic-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Monitors</h2>
            <button onclick="showMonitorModal()" class="btn btn-primary add-monitor-btn" style="display: flex; align-items: center; gap: 0.5rem; background: linear-gradient(135deg, #c5a572 0%, #b38b5d 100%); color: white; padding: 0.75rem 1.5rem; font-weight: 600; letter-spacing: 1px; border-radius: 0.375rem; border: none; cursor: pointer; transition: all 0.2s; text-transform: uppercase; box-shadow: 0 4px 6px rgba(197, 165, 114, 0.3);">
                <i class="fas fa-plus-circle" style="font-size: 1.1rem;"></i> Add Monitor
            </button>
        </div>

        <div class="monitor-table" style="background: linear-gradient(135deg, rgba(42, 42, 42, 0.7) 0%, rgba(26, 26, 26, 0.8) 100%); border-radius: 0.75rem; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); margin: 1rem 0 2rem; overflow: hidden; border: 1px solid var(--border-color);">
            <table style="width: 100%; border-collapse: collapse; font-family: 'Roboto Mono', monospace;">
                <thead>
                    <tr style="background: linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(42, 42, 42, 0.8) 100%);">
                        <th style="padding: 1.25rem 1rem; text-align: left; font-weight: 600; color: var(--accent-color); border-bottom: 1px solid var(--border-color); text-transform: uppercase; letter-spacing: 1.5px; font-family: 'Space Grotesk', sans-serif;">
                            <i class="fas fa-server" style="margin-right: 0.5rem;"></i>Monitor
                        </th>
                        <th style="padding: 1.25rem 1rem; text-align: center; font-weight: 600; color: var(--accent-color); border-bottom: 1px solid var(--border-color); text-transform: uppercase; letter-spacing: 1.5px; font-family: 'Space Grotesk', sans-serif;">
                            <i class="fas fa-signal" style="margin-right: 0.5rem;"></i>Status
                        </th>
                        <th style="padding: 1.25rem 1rem; text-align: center; font-weight: 600; color: var(--accent-color); border-bottom: 1px solid var(--border-color); text-transform: uppercase; letter-spacing: 1.5px; font-family: 'Space Grotesk', sans-serif;">
                            <i class="fas fa-tachometer-alt" style="margin-right: 0.5rem;"></i>Response Time
                        </th>
                        <th style="padding: 1.25rem 1rem; text-align: left; font-weight: 600; color: var(--accent-color); border-bottom: 1px solid var(--border-color); text-transform: uppercase; letter-spacing: 1.5px; font-family: 'Space Grotesk', sans-serif;">
                            <i class="fas fa-history" style="margin-right: 0.5rem;"></i>Last Checked
                        </th>
                        <th style="padding: 1.25rem 1rem; text-align: center; font-weight: 600; color: var(--accent-color); border-bottom: 1px solid var(--border-color); text-transform: uppercase; letter-spacing: 1.5px; font-family: 'Space Grotesk', sans-serif;">
                            <i class="fas fa-code" style="margin-right: 0.5rem;"></i>Response Code
                        </th>
                        <th style="padding: 1.25rem 1rem; text-align: left; font-weight: 600; color: var(--accent-color); border-bottom: 1px solid var(--border-color); text-transform: uppercase; letter-spacing: 1.5px; font-family: 'Space Grotesk', sans-serif;">
                            <i class="fas fa-cogs" style="margin-right: 0.5rem;"></i>Actions
                        </th>
                    </tr>
                </thead>
                <tbody id="monitor-list" style="font-family: 'Roboto Mono', monospace;">
                    <!-- Monitors will be populated here -->
                    <tr>
                        <td colspan="6" style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem; display: block;"></i>
                            <span style="font-size: 1.2rem; font-weight: 500;">Loading monitors...</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Monitor Modal -->
        <div id="monitor-modal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
            <div class="modal" style="background: linear-gradient(135deg, rgba(42, 42, 42, 0.95) 0%, rgba(26, 26, 26, 0.98) 100%); border-radius: 0.75rem; padding: 0; width: 90%; max-width: 500px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5); border: 1px solid var(--border-color); overflow: hidden;">
                <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; border-bottom: 1px solid var(--border-color); background: linear-gradient(135deg, rgba(26, 26, 26, 0.9) 0%, rgba(42, 42, 42, 0.8) 100%);">
                    <h2 style="margin: 0; color: var(--accent-color); font-size: 1.5rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1.5px; background: var(--metallic-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                        <i class="fas fa-plus-circle" style="margin-right: 0.75rem;"></i>Add Monitor
                    </h2>
                    <span class="modal-close" onclick="closeMonitorModal()" style="font-size: 1.5rem; cursor: pointer; color: var(--text-secondary); transition: color 0.2s; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: rgba(255, 255, 255, 0.1);">&times;</span>
                </div>
                <form id="monitor-form" style="padding: 1.5rem;">
                    <input type="hidden" id="monitor-id">
                    <div class="form-group" style="margin-bottom: 1.25rem;">
                        <label for="name" style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">
                            <i class="fas fa-tag" style="margin-right: 0.5rem; color: var(--accent-color);"></i>Monitor Name
                        </label>
                        <input type="text" id="name" required class="form-control" placeholder="Enter monitor name" style="width: 100%; padding: 0.75rem; background: rgba(26, 26, 26, 0.7); border: 1px solid var(--border-color); border-radius: 0.375rem; color: var(--text-primary); font-size: 1rem; transition: all 0.2s;">
                    </div>
                    <div class="form-group" style="margin-bottom: 1.25rem;">
                        <label for="url" style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">
                            <i class="fas fa-link" style="margin-right: 0.5rem; color: var(--accent-color);"></i>URL
                        </label>
                        <input type="text" id="url" required class="form-control" placeholder="https://example.com" style="width: 100%; padding: 0.75rem; background: rgba(26, 26, 26, 0.7); border: 1px solid var(--border-color); border-radius: 0.375rem; color: var(--text-primary); font-size: 1rem; transition: all 0.2s;">
                    </div>
                    <div class="form-group" style="margin-bottom: 1.25rem;">
                        <label for="method" style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">
                            <i class="fas fa-exchange-alt" style="margin-right: 0.5rem; color: var(--accent-color);"></i>HTTP Method
                        </label>
                        <select id="method" required class="form-control" style="width: 100%; padding: 0.75rem; background: rgba(26, 26, 26, 0.7); border: 1px solid var(--border-color); border-radius: 0.375rem; color: var(--text-primary); font-size: 1rem; transition: all 0.2s; appearance: none; background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1rem; padding-right: 2.5rem;">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                            <option value="HEAD">HEAD</option>
                            <option value="OPTIONS">OPTIONS</option>
                            <option value="PATCH">PATCH</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 1.25rem;">
                        <label for="requestType" style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">
                            <i class="fas fa-exchange-alt" style="margin-right: 0.5rem; color: var(--accent-color);"></i>Request Type
                        </label>
                        <select id="requestType" name="requestType" class="form-control" onchange="handleRequestTypeChange()" style="width: 100%; padding: 0.75rem; background: rgba(26, 26, 26, 0.7); border: 1px solid var(--border-color); border-radius: 0.375rem; color: var(--text-primary); font-size: 1rem; transition: all 0.2s;">
                            <option value="http">HTTP</option>
                            <option value="curl">cURL</option>
                        </select>
                    </div>
                    <div id="curlFormSection" style="display: none; margin-bottom: 1.25rem; background: rgba(26, 26, 26, 0.5); padding: 1rem; border-radius: 0.375rem; border: 1px solid var(--border-color);">
                        <div style="margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">
                            <i class="fas fa-info-circle" style="margin-right: 0.5rem; color: var(--accent-color);"></i>cURL Mode Instructions
                        </div>
                        <p style="color: var(--text-primary); margin-bottom: 1rem; font-size: 0.9rem;">
                            When using cURL mode, you can paste a full cURL command in the body field. For form data, use the format:<br>
                            <code style="background: rgba(0, 0, 0, 0.3); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-family: monospace; display: block; margin: 0.5rem 0; color: var(--accent-color);">--form 'key=value' --form 'another_key=another_value'</code>
                        </p>
                        <p style="color: var(--text-primary); margin-bottom: 0.5rem; font-size: 0.9rem;">
                            For OAuth token refresh example:<br>
                            <code style="background: rgba(0, 0, 0, 0.3); padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-family: monospace; display: block; margin: 0.5rem 0; color: var(--accent-color);">--form 'client_id=YOUR_CLIENT_ID' --form 'client_secret=YOUR_CLIENT_SECRET' --form 'refresh_token=YOUR_REFRESH_TOKEN' --form 'grant_type=refresh_token'</code>
                        </p>
                    </div>
                    <div class="form-group" style="margin-bottom: 1.25rem;">
                        <label for="credentialSelect" style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">
                            <i class="fas fa-key" style="margin-right: 0.5rem; color: var(--accent-color);"></i>Credential (Optional)
                        </label>
                        <select id="credentialSelect" class="form-control" style="width: 100%; padding: 0.75rem; background: rgba(26, 26, 26, 0.7); border: 1px solid var(--border-color); border-radius: 0.375rem; color: var(--text-primary); font-size: 1rem; transition: all 0.2s; appearance: none; background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1rem; padding-right: 2.5rem;">
                            <option value="">No Credential</option>
                        </select>
                        <small class="form-text text-muted" style="display: block; margin-top: 0.25rem; color: #888; font-size: 0.8rem;">Select a credential for authentication if required</small>
                    </div>
                    <div class="form-group" style="margin-bottom: 1.25rem;">
                        <label for="headers" style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">
                            <i class="fas fa-list" style="margin-right: 0.5rem; color: var(--accent-color);"></i>Headers (JSON)
                        </label>
                        <textarea id="headers" class="form-control" rows="3" placeholder='{"Content-Type": "application/json"}' style="width: 100%; padding: 0.75rem; background: rgba(26, 26, 26, 0.7); border: 1px solid var(--border-color); border-radius: 0.375rem; color: var(--text-primary); font-size: 0.9rem; font-family: monospace; transition: all 0.2s; min-height: 80px; resize: vertical;"></textarea>
                    </div>
                    <div class="form-group" style="margin-bottom: 1.25rem;">
                        <label for="body" style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">
                            <i class="fas fa-file-code" style="margin-right: 0.5rem; color: var(--accent-color);"></i>Request Body (JSON)
                        </label>
                        <textarea id="body" class="form-control" rows="3" placeholder='{"key": "value"}' style="width: 100%; padding: 0.75rem; background: rgba(26, 26, 26, 0.7); border: 1px solid var(--border-color); border-radius: 0.375rem; color: var(--text-primary); font-size: 0.9rem; font-family: monospace; transition: all 0.2s; min-height: 80px; resize: vertical;"></textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.25rem;">
                        <div class="form-group">
                            <label for="check_interval" style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">
                                <i class="fas fa-clock" style="margin-right: 0.5rem; color: var(--accent-color);"></i>Check Interval (seconds)
                            </label>
                            <input type="number" id="check_interval" required class="form-control" value="60" min="10" style="width: 100%; padding: 0.75rem; background: rgba(26, 26, 26, 0.7); border: 1px solid var(--border-color); border-radius: 0.375rem; color: var(--text-primary); font-size: 1rem; transition: all 0.2s;">
                    </div>
                    <div class="form-group">
                            <label for="failureThreshold" style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: 500; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">
                                <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem; color: var(--accent-color);"></i>Failure Threshold
                            </label>
                            <input type="number" id="failureThreshold" required class="form-control" value="1" min="1" style="width: 100%; padding: 0.75rem; background: rgba(26, 26, 26, 0.7); border: 1px solid var(--border-color); border-radius: 0.375rem; color: var(--text-primary); font-size: 1rem; transition: all 0.2s;">
                        </div>
                    </div>
                    <div class="modal-footer" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 1rem;">
                        <button type="button" onclick="closeMonitorModal()" class="btn-modal secondary" style="padding: 0.75rem 1.5rem; font-size: 0.9rem; font-weight: 600; letter-spacing: 1px; border-radius: 0.375rem; transition: all 0.2s; background: rgba(42, 42, 42, 0.7); color: var(--text-secondary); border: 1px solid var(--border-color); cursor: pointer; text-transform: uppercase;">
                            <i class="fas fa-times" style="margin-right: 0.5rem;"></i>Cancel
                        </button>
                        <button type="submit" class="btn-modal primary" style="padding: 0.75rem 1.5rem; font-size: 0.9rem; font-weight: 600; letter-spacing: 1px; border-radius: 0.375rem; transition: all 0.2s; background: linear-gradient(135deg, #c5a572 0%, #b38b5d 100%); color: white; border: none; cursor: pointer; text-transform: uppercase; box-shadow: 0 4px 6px rgba(197, 165, 114, 0.3);">
                            <i class="fas fa-save" style="margin-right: 0.5rem;"></i>Save Monitor
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Add Profile Modal -->
    <div id="profileModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="profileModalTitle" style="font-size: 1.25rem; font-weight: bold;">Add Profile</h3>
                <span class="modal-close" onclick="closeProfileModal()">√ó</span>
            </div>
            <form id="profileForm" onsubmit="handleProfileSubmit(event)">
                <input type="hidden" id="profileId">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem;">Profile Name</label>
                    <input type="text" id="profileName" required style="width: 100%; padding: 0.5rem;">
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem;">Description</label>
                    <textarea id="profileDescription" style="width: 100%; padding: 0.5rem; min-height: 100px;"></textarea>
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 0.5rem;">
                    <button type="button" onclick="closeProfileModal()" class="btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Profile</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Method Modal -->
   

    <script>
        // Remove the inline loadMonitors function since we've updated the one in app.js
    </script>

    <script src="/static/app.js"></script>
    <script src="/static/notifications.js"></script>
    <script>
        // Force reload CSS files to ensure they're properly loaded
        function forceReloadCSS() {
            const links = document.getElementsByTagName('link');
            for (let i = 0; i < links.length; i++) {
                if (links[i].rel === 'stylesheet') {
                    const href = links[i].href;
                    links[i].href = href + '?reload=' + new Date().getTime();
                    console.log('Forced reload of CSS:', href);
                }
            }
        }
        
        // Call the function to reload CSS
        forceReloadCSS();
        
        // Check if Font Awesome is loaded properly
        function checkFontAwesome() {
            // Create a test icon
            const testIcon = document.createElement('i');
            testIcon.className = 'fas fa-check';
            testIcon.style.display = 'none';
            document.body.appendChild(testIcon);
            
            // Check if the icon has the correct font
            const fontFamily = window.getComputedStyle(testIcon).getPropertyValue('font-family');
            const isLoaded = fontFamily.includes('Font Awesome') || fontFamily.includes('FontAwesome');
            
            // Clean up
            document.body.removeChild(testIcon);
            
            console.log('Font Awesome loaded:', isLoaded, 'Font Family:', fontFamily);
            
            // If not loaded, try to add it again
            if (!isLoaded) {
                console.warn('Font Awesome not loaded, adding it manually');
                
                // First try to remove any existing Font Awesome links
                const links = document.getElementsByTagName('link');
                for (let i = 0; i < links.length; i++) {
                    if (links[i].href.includes('font-awesome')) {
                        links[i].parentNode.removeChild(links[i]);
                        i--; // Adjust index after removal
                    }
                }
                
                // Add Font Awesome with different CDN
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = 'https://use.fontawesome.com/releases/v6.5.1/css/all.css';
                document.head.appendChild(link);
                
                // Also try adding Font Awesome from cdnjs
                const link2 = document.createElement('link');
                link2.rel = 'stylesheet';
                link2.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css';
                document.head.appendChild(link2);
                
                // Force load monitors after a delay
                setTimeout(() => {
                    if (typeof loadMonitors === 'function') {
                        loadMonitors().catch(error => {
                            console.error('Error loading monitors after Font Awesome check:', error);
                        });
                    }
                }, 1000);
            }
        }
        
        // Call the function to check Font Awesome
        setTimeout(checkFontAwesome, 500);

        // Ensure loadMethods is defined as a fallback
        if (typeof window.loadMethods !== 'function') {
            window.loadMethods = function() {
                console.warn('loadMethods function not defined');
            };
        }

        // Define loadMethodsHandler
        window.loadMethodsHandler = function() {
            loadProfiles();
            window.loadMethods();
            
            // Also load monitors when profiles are loaded
            setTimeout(() => {
                if (typeof loadMonitors === 'function') {
                    loadMonitors().catch(error => {
                        console.error('Error loading monitors from handler:', error);
                    });
                }
            }, 500); // Small delay to ensure profiles are loaded first
        };

        // Remove any existing listeners first
        document.removeEventListener('DOMContentLoaded', window.loadMethodsHandler);
        
        // Add the event listener
        document.addEventListener('DOMContentLoaded', function() {
            window.loadMethodsHandler();

            // Ensure monitor form submission is handled correctly
            const monitorForm = document.getElementById('monitor-form');
            if (monitorForm) {
                // Remove any existing submit event listeners
                const newMonitorForm = monitorForm.cloneNode(true);
                monitorForm.parentNode.replaceChild(newMonitorForm, monitorForm);
                
                // Add new submit event listener
                newMonitorForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleMonitorSubmit(e);
                });
            }
            
            // Add event listeners for JSON formatting
            const headersField = document.getElementById('headers');
            const bodyField = document.getElementById('body');
            
            if (headersField) {
                headersField.addEventListener('blur', function() {
                    formatJsonInput('headers');
                });
            }
            
            if (bodyField) {
                bodyField.addEventListener('blur', function() {
                    formatJsonInput('body');
                });
            }
            
            // Explicitly load monitors on page load
            if (typeof loadMonitors === 'function') {
                loadMonitors().catch(error => {
                    console.error('Error loading monitors on page load:', error);
                });
            } else {
                console.error('loadMonitors function not defined');
            }
        });

        // Function to close monitor modal
        function closeMonitorModal() {
            const modal = document.getElementById('monitor-modal');
            if (modal) {
                modal.style.display = 'none';
            }
            // Reset form
            const monitorForm = document.getElementById('monitor-form');
            if (monitorForm) {
                monitorForm.reset();
            }
        }

        // Function to show monitor modal and load credentials
        function showMonitorModal() {
            // First load credentials
            console.log('Opening monitor modal and loading credentials...');
            
            // Try to load credentials
            if (typeof loadCredentials === 'function') {
                loadCredentials().then(() => {
                    console.log('Credentials loaded for monitor modal');
                }).catch(error => {
                    console.error('Error loading credentials for monitor modal:', error);
                });
            } else {
                console.error('loadCredentials function not available');
            }
            
            // Show the modal
            const modal = document.getElementById('monitor-modal');
            if (modal) {
                modal.style.display = 'flex';
            }
        }

        // Function to handle monitor form submission
        async function handleMonitorSubmit(event) {
            event.preventDefault();
            
            // Disable the submit button to prevent multiple submissions
            const submitButton = document.querySelector('#monitor-form button[type="submit"]');
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            
            const profileId = getCurrentProfileId();
            if (!profileId) {
                showNotification('Please select a profile first', 'error');
                // Re-enable the button
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-save"></i> Save Monitor';
                return;
            }
            
            // Get form values
            const name = document.getElementById('name').value.trim();
            const url = document.getElementById('url').value.trim();
            const method = document.getElementById('method').value;
            const requestType = document.getElementById('requestType').value;
            const headersStr = document.getElementById('headers').value.trim();
            const bodyStr = document.getElementById('body').value.trim();
            const credentialId = document.getElementById('credentialSelect').value;
            const checkInterval = parseInt(document.getElementById('check_interval').value);
            const failureThreshold = parseInt(document.getElementById('failureThreshold').value);
            
            // Validate required fields
            if (!name || !url) {
                showNotification('Name and URL are required', 'error');
                // Re-enable the button
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-save"></i> Save Monitor';
                return;
            }
            
            // Validate headers JSON if not empty and not in curl mode with form data
            if (headersStr && requestType !== 'curl') {
                try {
                    JSON.parse(headersStr);
                } catch (error) {
                    showNotification('Headers must be valid JSON', 'error');
                    // Re-enable the button
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<i class="fas fa-save"></i> Save Monitor';
                    return;
                }
            }
            
            // Validate body JSON if not empty and not in curl mode with form data
            if (bodyStr && requestType !== 'curl' && !bodyStr.includes('--form')) {
                try {
                    JSON.parse(bodyStr);
                } catch (error) {
                    showNotification('Body must be valid JSON', 'error');
                    // Re-enable the button
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<i class="fas fa-save"></i> Save Monitor';
                    return;
                }
            }
            
            // Create monitor data object
            const monitorData = {
                name,
                url,
                method,
                request_type: requestType,
                headers: headersStr,
                body: bodyStr,
                credential_id: credentialId || "",
                check_interval: checkInterval || 60,
                failure_threshold: failureThreshold || 1
            };
            
            console.log('Sending monitor data:', monitorData);
            
            try {
                const response = await fetch('/api/monitors', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Profile-ID': profileId
                    },
                    body: JSON.stringify(monitorData)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`Failed to create monitor: ${errorData.error || response.statusText}`);
                }
                
                showNotification('Monitor created successfully', 'success');
                closeMonitorModal();
                loadMonitors();
            } catch (error) {
                console.error('Error creating monitor:', error);
                showNotification(error.message, 'error');
            } finally {
                // Re-enable the button regardless of success or failure
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fas fa-save"></i> Save Monitor';
            }
        }

        // Function to delete a monitor
        async function deleteMonitor(monitorId) {
            if (!confirm('Are you sure you want to delete this monitor?')) {
                return;
            }
            
            try {
                const profileId = localStorage.getItem('profile_id');
                if (!profileId) {
                    showNotification('No active profile selected', 'error');
                    return;
                }
                
                const response = await fetch(`/api/monitors/${monitorId}`, {
                    method: 'DELETE',
                    headers: {
                        'X-Profile-ID': profileId
                    }
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Failed to delete monitor: ${errorText}`);
                }
                
                showNotification('Monitor deleted successfully', 'success');
                loadMonitors();
            } catch (error) {
                console.error('Error deleting monitor:', error);
                showNotification(`Error: ${error.message}`, 'error');
            }
        }

        // Function to reset failures for a monitor
        async function resetFailures(monitorId) {
            try {
                const profileId = localStorage.getItem('profile_id');
                if (!profileId) {
                    showNotification('No active profile selected', 'error');
                    return;
                }
                
                const response = await fetch(`/api/monitors/${monitorId}/reset-failures`, {
                    method: 'POST',
                    headers: {
                        'X-Profile-ID': profileId,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Failed to reset failures: ${errorText}`);
                }
                
                showNotification('Failures reset successfully', 'success');
                loadMonitors();
            } catch (error) {
                console.error('Error resetting failures:', error);
                showNotification(`Error: ${error.message}`, 'error');
            }
        }

        // Function to handle profile change
        async function handleProfileChange() {
            const profileSelect = document.getElementById('profileSelect');
            const selectedProfileId = profileSelect.value;
            
            if (!selectedProfileId) {
                showNotification('Please select a profile', 'warning');
                return;
            }
            
            console.log('Profile changed to:', selectedProfileId);
            localStorage.setItem('profile_id', selectedProfileId);
            
            try {
                // Set the profile as active on the server
                const response = await fetch(`/api/profiles/${selectedProfileId}/activate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Failed to activate profile: ${errorText}`);
                }
                
                showNotification('Profile activated successfully', 'success');
                
                // Reload monitors and credentials
                await loadMonitors();
                await loadCredentials();
            } catch (error) {
                console.error('Error activating profile:', error);
                showNotification(`Error: ${error.message}`, 'error');
            }
        }

        // Function to show add profile modal
        function showAddProfileModal() {
            const modal = document.getElementById('profileModal');
            const title = document.getElementById('profileModalTitle');
            const form = document.getElementById('profileForm');
            
            // Reset form
            form.reset();
            document.getElementById('profileId').value = '';
            
            // Set title
            title.textContent = 'Add Profile';
            
            // Show modal
            modal.style.display = 'flex';
        }

        // Function to close profile modal
        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            modal.style.display = 'none';
        }

        // Function to handle profile form submission
        async function handleProfileSubmit(event) {
            event.preventDefault();
            
            const profileId = document.getElementById('profileId').value;
            const name = document.getElementById('profileName').value;
            const description = document.getElementById('profileDescription').value;
            
            if (!name) {
                showNotification('Profile name is required', 'error');
                return;
            }
            
            try {
                const endpoint = profileId ? `/api/profiles/${profileId}` : '/api/profiles';
                const method = profileId ? 'PUT' : 'POST';
                
                const response = await fetch(endpoint, {
                    method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        description
                    })
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Failed to ${profileId ? 'update' : 'create'} profile: ${errorText}`);
                }
                
                showNotification(`Profile ${profileId ? 'updated' : 'created'} successfully`, 'success');
                
                // Close modal and reload profiles
                closeProfileModal();
                await loadProfiles();
            } catch (error) {
                console.error('Error submitting profile:', error);
                showNotification(`Error: ${error.message}`, 'error');
            }
        }

        // Function to format JSON input
        function formatJsonInput(fieldId) {
            const field = document.getElementById(fieldId);
            if (!field || !field.value.trim()) return;
            
            try {
                // Parse and re-stringify to format
                const parsed = JSON.parse(field.value);
                field.value = JSON.stringify(parsed, null, 2);
            } catch (e) {
                console.warn(`Invalid JSON in ${fieldId}:`, e);
                // Don't show notification here as it would be annoying
                // Just leave the value as-is
            }
        }

        // Add this function to handle request type change
        function handleRequestTypeChange() {
            const requestType = document.getElementById('requestType').value;
            const curlFormSection = document.getElementById('curlFormSection');
            const headersField = document.getElementById('headers');
            const bodyField = document.getElementById('body');
            
            if (requestType === 'curl') {
                curlFormSection.style.display = 'block';
                
                // Update placeholders for curl mode
                headersField.placeholder = '{"Content-Type": "application/x-www-form-urlencoded"}';
                bodyField.placeholder = '--form \'client_id=YOUR_CLIENT_ID\' --form \'client_secret=YOUR_CLIENT_SECRET\' --form \'refresh_token=YOUR_REFRESH_TOKEN\' --form \'grant_type=refresh_token\'';
            } else {
                curlFormSection.style.display = 'none';
                
                // Reset placeholders for HTTP mode
                headersField.placeholder = '{"Content-Type": "application/json"}';
                bodyField.placeholder = '{"key": "value"}';
            }
        }

        (async () => {
            console.group('üïµÔ∏è Enhanced Credential Loading Diagnostic');
            
            try {
                console.log('1. Checking if functions are defined:');
                console.log('   - getCurrentProfileId defined:', typeof getCurrentProfileId === 'function');
                console.log('   - loadCredentials defined:', typeof loadCredentials === 'function');
                console.log('   - loadMonitors defined:', typeof loadMonitors === 'function');
                console.log('   - loadProfiles defined:', typeof loadProfiles === 'function');
                
                // Check profile selection
                const profileSelect = document.getElementById('profileSelect');
                console.log('2. Profile Select:', profileSelect);
                console.log('   Selected Profile:', profileSelect ? profileSelect.value : 'Not found');
                
                // Check current profile ID determination
                const profileId = localStorage.getItem('profile_id');
                console.log('3. Profile ID from localStorage:', profileId);
                
                // Check credential select
                const credentialSelect = document.getElementById('credentialSelect');
                console.log('4. Credential Select:', credentialSelect);
                console.log('   Credential Options:', credentialSelect ? credentialSelect.innerHTML : 'Not found');
                
                // Try to manually load credentials
                console.log('5. Attempting to manually load credentials...');
                if (typeof loadCredentials === 'function') {
                    await loadCredentials();
                    console.log('   Credentials loaded successfully');
                } else {
                    console.error('   loadCredentials function not defined');
                }
                
                // Check credential select again after loading
                console.log('6. Credential Select after loading:');
                console.log('   Credential Options:', credentialSelect ? credentialSelect.innerHTML : 'Not found');
            } catch (error) {
                console.error('Diagnostic Error:', error);
            }
            
            console.groupEnd();
        })();

        // Add auto-refresh for monitors every 10 seconds
        console.log('Setting up auto-refresh for monitors every 10 seconds');
        setInterval(async () => {
            console.log('Auto-refreshing monitors...');
            try {
                await loadMonitors();
                console.log('Monitors refreshed successfully');
            } catch (error) {
                console.error('Error refreshing monitors:', error);
            }
        }, 10000);
    </script>
</body>
</html>
